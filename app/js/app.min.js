"use strict";function BackupDataController(e,t,n,o,a){function r(){var n=j.Deferred();return t.get("/ExpenseDetails/"+e.Detail.year+"/"+e.Detail.month+"/"+o.User).then(function(t){console.log(t),e.OriginalData=t.data,e.filterData=t.data,e.Details=t.data;var o=e.Detail.year,a=e.Detail.month;l(),e.Detail.year=o,e.Detail.month=a,null!=document.getElementById("dynamicDownloadLink")&&document.getElementById("content").removeChild(document.getElementById("dynamicDownloadLink")),n.resolve()},function(e){console.log(e),n.reject(e)}),n.promise()}console.log("inside backup controller"),e.months=["January","February","March","April","May","June","July","August","September","October","November","December"],e.hideTable=!0,e.args="",e.message,e.Details=[],e.OriginalData="",e.filterData="";var l=function(){e.Detail.year="",e.Detail.month="",e.Detail.week="",e.Detail.expenditures="",e.Detail.date="",e.Detail.Amount="",e.Detail.expenseComment=""};e.generateBackupForm=function(){return void 0==e.Detail||void 0==e.Detail.year?void(e.message={status:a.danger,details:"Year is required"}):(e.message="",void(e.hideTable=!1))},e.monitorYear=function(){void 0==e.Detail.year&&(e.OriginalData="",e.filterData="",e.Details="",e.Detail="",e.hideTable=!0)};var i=function(){e.filterData=e.OriginalData,""!==e.Detail.month&&void 0!==e.Detail.month&&null!==e.Detail.month&&(e.filterData=e.filterData.filter(function(t,n){return t.month===e.Detail.month})),e.Details=e.filterData};e.monitorMonth=function(){r().then(function(){i()})},e.backup=function(){if(void 0!==e.Detail.month&&null!==e.Detail.month){for(var t=e.OriginalData,n=0;n<t.length;n++)delete t[n].$$hashKey,delete t[n]._id;var o=JSON.stringify(t),a=new Blob([o],{type:"application/json"}),r=URL.createObjectURL(a),l=document.createElement("div");l.id="dynamicDownloadLink",document.getElementById("content").appendChild(l);var i=document.createElement("a");i.download=e.Detail.year+"_"+e.Detail.month+".json",i.href=r,i.textContent="Download "+e.Detail.year+"_"+e.Detail.month+".json",document.getElementById("dynamicDownloadLink").appendChild(i)}}}function expenditureCategoryController(e,t,n){e.message;var o=function(){t.get("/ExpenditureCategory").then(function(t){e.expenditures=t.data,e.message={status:n.info,details:"info"}},function(e){console.log(e)})};o(),e.saveExpenditureCategory=function(){console.log(e.expCat);var a={expenditureCategory:e.expCat};t.post("/ExpenditureCategory",a).then(function(){e.message={status:n.success,details:"success"},o()},function(e){console.log(e)}),e.expCat=""}}function incomeController(e,t,n,o,a,r){function l(){var n=j.Deferred();return t.get("/ExpenseDetails/"+e.Detail.year+"/"+e.Detail.month+"/"+o.User).then(function(t){console.log(t),e.OriginalData=t.data,e.filterData=t.data,e.Details=t.data;var o=e.Detail.year,a=e.Detail.month;i(),e.Detail.year=o,e.Detail.month=a,s(),e.Hello=r.drawPieChart(e.filterData),n.resolve()},function(e){console.log(e),n.reject(e)}),n.promise()}console.log("successfully inside income controller"),e.months=["January","February","March","April","May","June","July","August","September","October","November","December"],e.weeks=["week 1","week 2","week 3","week 4","week 5"],e.hideTable=!0,e.args="",e.message,e.Details=[],e.OriginalData="",e.filterData="";var i=function(){e.Detail.year="",e.Detail.month="",e.Detail.week="",e.Detail.expenditures="",e.Detail.paymentMode="",e.Detail.date="",e.Detail.Amount="",e.Detail.expenseComment=""},s=function(){e.totalSpent=0;for(var t in e.filterData)e.totalSpent+=e.filterData[t].Amount};e.monitorYear=function(){void 0==e.Detail.year&&(e.OriginalData="",e.filterData="",e.Details="",e.Detail="",e.hideTable=!0)},e.generateExpenseForm=function(){return void 0==e.Detail||void 0==e.Detail.year?void(e.message={status:a.danger,details:"Year is required"}):(e.message="",e.getExpenditure(),e.getPaymentMode(),void(e.hideTable=!1))};var c=function(){e.filterData=e.OriginalData,""!==e.Detail.month&&void 0!==e.Detail.month&&null!==e.Detail.month&&(e.filterData=e.filterData.filter(function(t,n){return t.month===e.Detail.month})),""!==e.Detail.week&&void 0!==e.Detail.week&&null!==e.Detail.week&&(e.filterData=e.filterData.filter(function(t,n){return t.week===e.Detail.week})),""!==e.Detail.expenditures&&void 0!==e.Detail.expenditures&&null!==e.Detail.expenditures&&(e.filterData=e.filterData.filter(function(t,n){return t.expenditures===e.Detail.expenditures})),""!==e.Detail.paymentMode&&void 0!==e.Detail.paymentMode&&null!==e.Detail.paymentMode&&(e.filterData=e.filterData.filter(function(t,n){return t.paymentMode===e.Detail.paymentMode})),s(),e.Hello=r.drawPieChart(e.filterData),e.Details=e.filterData};e.monitorMonth=function(){l().then(function(){c()})},e.monitorChange=function(){c()},e.getExpenditure=function(){e.expenditures=null==n.get("Expenditures")?[]:JSON.parse(n.get("Expenditures")),e.expenditures.length<=0?(e.args="expenditure",t.get("/ExpenseDetails"+e.args).then(function(t){e.expendituresfromdb=t.data,n.put("Expenditures",JSON.stringify(e.expendituresfromdb)),e.expenditure="(blank)",e.message={status:a.info,details:"info"}},function(e){console.log(e)})):(e.expendituresfromdb=e.expenditures,e.expenditure="(blank)")},e.getPaymentMode=function(){e.paymentModes=null==n.get("PaymentMode")?[]:JSON.parse(n.get("PaymentMode")),e.paymentModes.length<=0?(e.args="paymentMode",t.get("/ExpenseDetails"+e.args).then(function(t){e.paymentModefromdb=t.data,n.put("PaymentMode",JSON.stringify(e.paymentModefromdb)),e.paymentMode="(blank)",e.message={status:a.info,details:"info"}},function(e){console.log(e)})):(e.paymentModefromdb=e.paymentModes,e.paymentMode="(blank)")},e.addDetails=function(){console.log(e.Detail),e.Detail.user=o.User,t.post("/ExpenseDetails",e.Detail).then(function(t){console.log(t),l(),i(),e.Detail.year=t.data.year,e.Detail.month=t.data.month,e.message={status:a.success,details:"success"}},function(e){console.log(e)})},e.remove=function(e){console.log(e),t["delete"]("/ExpenseDetails/"+e).success(function(e){l()})},e.edit=function(n){console.log(n),t.get("/ExpenseDetails/"+n+"/details/"+o.User).success(function(t){e.Detail=t,e.Detail.expenditures=t.expenditures,c(),console.log(e.Detail)})},e.update=function(){console.log(e.Detail._id),t.put("/ExpenseDetails/"+e.Detail._id,e.Detail).success(function(e){l()})},e.deselect=function(){e.Detail="",e.hideTable=!0}}function incomeDetailsController(e,t,n,o,a,r){function l(){var n=j.Deferred();return t.get("/IncomeDetails/"+e.Income.year+"/"+e.Income.month+"/"+o.User).then(function(t){console.log(t),e.OriginalData=t.data,e.filterData=t.data,e.Incomes=t.data;var o=e.Income.year,a=e.Income.month;i(),e.Income.year=o,e.Income.month=a,s(),e.Hello=r.drawPieChart(e.filterData),n.resolve()},function(e){console.log(e),n.reject(e)}),n.promise()}console.log("successfully inside income Incomes controller"),e.months=["January","February","March","April","May","June","July","August","September","October","November","December"],e.weeks=["week 1","week 2","week 3","week 4","week 5"],e.types=["Salary","Rent","Cash Withdraw"],e.hideTable=!0,e.args="",e.message,e.Incomes=[],e.OriginalData="",e.filterData="";var i=function(){e.Income.year="",e.Income.month="",e.Income.week="",e.Income.type="",e.Income.date="",e.Income.Amount="",e.Income.incomeComment=""},s=function(){e.monthlyIncome=0;for(var t in e.filterData)"Cash Withdraw"!==e.filterData[t].type?e.monthlyIncome+=e.filterData[t].Amount:e.monthlyIncome-=e.filterData[t].Amount};e.monitorYear=function(){void 0==e.Income.year&&(e.OriginalData="",e.filterData="",e.Incomes="",e.Income="",e.hideTable=!0)},e.generateIncomeForm=function(){return void 0==e.Income||void 0==e.Income.year?void(e.message={status:a.danger,Incomes:"Year is required"}):(e.message="",void(e.hideTable=!1))};var c=function(){e.filterData=e.OriginalData,""!==e.Income.month&&void 0!==e.Income.month&&null!==e.Income.month&&(e.filterData=e.filterData.filter(function(t,n){return t.month===e.Income.month})),""!==e.Income.week&&void 0!==e.Income.week&&null!==e.Income.week&&(e.filterData=e.filterData.filter(function(t,n){return t.week===e.Income.week})),""!==e.Income.type&&void 0!==e.Income.type&&null!==e.Income.type&&(e.filterData=e.filterData.filter(function(t,n){return t.type===e.Income.type})),s(),e.Hello=r.drawPieChart(e.filterData),e.Incomes=e.filterData};e.monitorMonth=function(){l().then(function(){c()})},e.monitorChange=function(){c()},e.addIncomes=function(){console.log(e.Income),e.Income.user=o.User,t.post("/IncomeDetails",e.Income).then(function(t){console.log(t),l(),i(),e.Income.year=t.data.year,e.Income.month=t.data.month,e.message={status:a.success,Incomes:"success"}},function(e){console.log(e)})},e.remove=function(e){console.log(e),t["delete"]("/IncomeDetails/"+e).success(function(e){l()})},e.edit=function(n){console.log(n),t.get("/IncomeDetails/"+n+"/Incomes/"+o.User).success(function(t){e.Income=t,e.Income.expenditures=t.expenditures,c(),console.log(e.Income)})},e.update=function(){console.log(e.Income._id),t.put("/IncomeDetails/"+e.Income._id,e.Income).success(function(e){l()})},e.deselect=function(){e.Income="",e.hideTable=!0}}function logOutController(e,t,n,o,a,r){console.log("successfully inside logout controller"),t.post("/logout").success(function(t){a.User=null,e.message={status:r.success,details:"logout successfull"},o.url("/logout")}).error(function(){a.User=null,e.message={status:r.danger,details:"logout successfull"},o.url("/logout")})}function loginController(e,t,n,o,a,r){console.log("Inside login Data Controller"),e.user={username:"",password:""},e.postLogin=function(){t.post("/login","username="+e.user.username+"&password="+e.user.password,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){a.message="Authentication successful!",o.url("/ExpenseDetails")}).error(function(){a.message="Authentication failed.",e.message={status:r.danger,details:"login failed"},o.url("/login")})},e.postSignUp=function(){o.url("/signin")}}function monthConfigController(e,t,n){e.message;var o=function(){t.get("/MonthConfig").then(function(t){e.months=t.data,e.message={status:n.info,details:"info"}},function(e){console.log(e)})};o(),e.saveMonth=function(){console.log(e.Month);var a={month:e.Month};t.post("/MonthConfig",a).then(function(){e.message={status:n.success,details:"success"}},function(e){console.log(e)}),e.Month="",o()}}function paymentModeController(e,t,n){e.message;var o=function(){t.get("/PaymentMode").then(function(t){e.paymentModes=t.data,e.message={status:n.info,details:"info"}},function(e){console.log(e)})};o(),e.savePaymentMode=function(){console.log(e.paymentMode);var a={paymentMode:e.paymentMode};t.post("/PaymentMode",a).then(function(){e.message={status:n.success,details:"success"},o()},function(e){console.log(e)}),e.paymentMode=""}}function RestoreDataController(e,t,n,o){console.log("Inside Restore Data Controller"),e.clickRestore=function(){console.log("sending the file field changes successfully.");var n=document.getElementById("SelectFile"),a=n.files[0],r=new FileReader;r.onload=function(n){var a=n.target.result;console.log("File contents: "+a),t.post("/RestoreData",a).then(function(t){console.log(t),e.message={status:o.success,details:"Restore successfull"}},function(e){console.log(e)})},r.onerror=function(e){console.error("File could not be read! Code "+e.target.error.code)},r.readAsText(a)}}function signinController(e,t,n,o,a,r){console.log("Inside SignIn Data Controller"),e.user={userName:"",password:""},e.signup=function(){t.post("/signin",e.user).success(function(e){o.url("/login")}).error(function(t){a.message="Signin failed.",e.message={status:r.danger,details:t},e.user={userName:"",password:""}})}}function weekConfigController(e,t,n){e.message;var o=function(){t.get("/WeekConfig").then(function(t){e.weeks=t.data,e.message={status:n.info,details:"info"}},function(e){console.log(e)})};o(),e.saveWeekNo=function(){console.log(e.weekNo);var a={week:e.weekNo};t.post("/WeekConfig",a).then(function(){e.message={status:n.success,details:"success"}},function(e){console.log(e)}),e.weekNo="",o()}}var app=angular.module("fintrackerApp",["ngRoute","ngCookies"]);app.config(["$routeProvider","$locationProvider","$httpProvider",function(e,t,n){var o=["$q","$timeout","$http","$location","$rootScope",function(e,t,n,o,a){var r=e.defer();return n.get("/loggedin").success(function(e){"0"!==e?(a.User=e.userName,r.resolve()):(a.message="You need to login",r.reject(),o.url("/login"))}),r.promise}];n.interceptors.push(["$q","$location","$rootScope",function(e,t,n){return{response:function(e){return e},responseError:function(o){return 401===o.status&&(n.User="",t.url("/login")),e.reject(o)}}}]),e.when("/ExpenseDetails",{templateUrl:"templates/expenseform.html",controller:"incomeController",resolve:{loggedin:o}}).when("/IncomeDetails",{templateUrl:"templates/IncomeDetails.html",controller:"incomeDetailsController",resolve:{loggedin:o}}).when("/ExpenditureCategory",{templateUrl:"templates/expenditureCategory.html",controller:"expenditureCategoryController",resolve:{loggedin:o}}).when("/PaymentMode",{templateUrl:"templates/paymentMode.html",controller:"paymentModeController",resolve:{loggedin:o}}).when("/BackupData",{templateUrl:"templates/BackupData.html",controller:"BackupDataController",resolve:{loggedin:o}}).when("/RestoreData",{templateUrl:"templates/RestoreData.html",controller:"RestoreDataController",resolve:{loggedin:o}}).when("/login",{templateUrl:"templates/login.html",controller:"loginController"}).when("/logout",{templateUrl:"templates/logout.html",controller:"logOutController"}).when("/signin",{templateUrl:"templates/signin.html",controller:"signinController"}).otherwise({redirectTo:"/ExpenseDetails"})}]);var j=jQuery.noConflict(),app=angular.module("fintrackerApp");app.controller("BackupDataController",BackupDataController),BackupDataController.$inject=["$scope","$http","$cookies","$rootScope","messages"];var app=angular.module("fintrackerApp");app.controller("expenditureCategoryController",expenditureCategoryController),expenditureCategoryController.$inject=["$scope","$http","messages"];var j=jQuery.noConflict(),app=angular.module("fintrackerApp");app.controller("incomeController",incomeController),incomeController.$inject=["$scope","$http","$cookies","$rootScope","messages","chart"],app.directive("jqdatepicker",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,o){t.datepicker()}}});var j=jQuery.noConflict(),app=angular.module("fintrackerApp");app.controller("incomeDetailsController",incomeDetailsController),incomeDetailsController.$inject=["$scope","$http","$cookies","$rootScope","messages","chartIncome"],app.directive("jqdatepicker",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,o){t.datepicker()}}});var j=jQuery.noConflict(),app=angular.module("fintrackerApp");app.controller("logOutController",logOutController),logOutController.$inject=["$scope","$http","$cookies","$location","$rootScope","messages"];var j=jQuery.noConflict(),app=angular.module("fintrackerApp");app.controller("loginController",loginController),loginController.$inject=["$scope","$http","$cookies","$location","$rootScope","messages"];var app=angular.module("fintrackerApp");app.controller("monthConfigController",monthConfigController),monthConfigController.$inject=["$scope","$http","messages"];var app=angular.module("fintrackerApp");app.controller("paymentModeController",paymentModeController),paymentModeController.$inject=["$scope","$http","messages"];var j=jQuery.noConflict(),app=angular.module("fintrackerApp");app.controller("RestoreDataController",RestoreDataController),RestoreDataController.$inject=["$scope","$http","$cookies","messages"];var j=jQuery.noConflict(),app=angular.module("fintrackerApp");app.controller("signinController",signinController),signinController.$inject=["$scope","$http","$cookies","$location","$rootScope","messages"];var app=angular.module("fintrackerApp");app.controller("weekConfigController",weekConfigController),weekConfigController.$inject=["$scope","$http","messages"],app.factory("chart",function(){function e(e){null!=d3.select("svg")&&d3.select("svg").remove();var t=[70,40,40,70],n=500-t[1]-t[3],o=430-t[0]-t[2],a=e.slice(),r=[];for(var l in a){var i=!1;if(0==r.length)r.push({expenditures:a[l].expenditures,Amount:a[l].Amount});else{for(var s in r)r[s].expenditures===a[l].expenditures&&(r[s].Amount+=a[l].Amount,i=!0);i||r.push({expenditures:a[l].expenditures,Amount:a[l].Amount})}}if(0!==a.length){var c=d3.format(",.0f"),u=d3.scale.linear().range([0,n]),m=d3.scale.ordinal().rangeRoundBands([0,o],.1),d=d3.svg.axis().scale(u).orient("top").tickSize(-o),p=d3.svg.axis().scale(m).orient("left").tickSize(0),f=d3.select("#chart").append("svg").attr("width",n+t[1]+t[3]).attr("height",o+t[0]+t[2]).append("g").attr("transform","translate("+t[3]+","+t[0]+")");r.forEach(function(e){e.Amount=+e.Amount}),r.sort(function(e,t){return t.Amount-e.Amount}),u.domain([0,d3.max(r,function(e){return e.Amount})]),m.domain(r.map(function(e){return e.expenditures}));var g=f.selectAll("g.bar").data(r).enter().append("g").attr("class","bar").attr("transform",function(e){return"translate(0,"+m(e.expenditures)+")"});g.append("rect").attr("width",function(e){return u(e.Amount)}).attr("height",m.rangeBand()),g.append("text").attr("class","value").attr("x",function(e){return u(e.Amount)}).attr("y",m.rangeBand()/2.5).attr("dx",-3).attr("dy",".35em").attr("text-anchor","end").text(function(e){return c(e.Amount)}),f.append("g").attr("class","x axis").call(d),f.append("g").attr("class","y axis").call(p)}}return{drawPieChart:e}}),app.factory("chartIncome",function(){function e(e){null!=d3.select("svg")&&d3.select("svg").remove();var t=[70,40,40,70],n=500-t[1]-t[3],o=430-t[0]-t[2],a=e.slice(),r=[];for(var l in a){var i=!1;if(0==r.length)r.push({type:a[l].type,Amount:a[l].Amount});else{for(var s in r)r[s].type===a[l].type&&(r[s].Amount+=a[l].Amount,i=!0);i||r.push({type:a[l].type,Amount:a[l].Amount})}}if(0!==a.length){var c=d3.format(",.0f"),u=d3.scale.linear().range([0,n]),m=d3.scale.ordinal().rangeRoundBands([0,o],.1),d=d3.svg.axis().scale(u).orient("top").tickSize(-o),p=d3.svg.axis().scale(m).orient("left").tickSize(0),f=d3.select("#chart").append("svg").attr("width",n+t[1]+t[3]).attr("height",o+t[0]+t[2]).append("g").attr("transform","translate("+t[3]+","+t[0]+")");r.forEach(function(e){e.Amount=+e.Amount}),r.sort(function(e,t){return t.Amount-e.Amount}),u.domain([0,d3.max(r,function(e){return e.Amount})]),m.domain(r.map(function(e){return e.type}));var g=f.selectAll("g.bar").data(r).enter().append("g").attr("class","bar").attr("transform",function(e){return"translate(0,"+m(e.type)+")"});g.append("rect").attr("width",function(e){return u(e.Amount)}).attr("height",m.rangeBand()),g.append("text").attr("class","value").attr("x",function(e){return u(e.Amount)}).attr("y",m.rangeBand()/2.5).attr("dx",-3).attr("dy",".35em").attr("text-anchor","end").text(function(e){return c(e.Amount)}),f.append("g").attr("class","x axis").call(d),f.append("g").attr("class","y axis").call(p)}}return{drawPieChart:e}}),app.factory("messages",function(){return{success:"success",info:"info",warning:"warning",danger:"danger"}});